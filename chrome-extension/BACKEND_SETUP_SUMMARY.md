# Backend Setup Summary

## What Was Created

The backend has been prepared to receive **all data** generated by the browser extension, including:

### âœ… Database Schema (`event-db.ts`)

**7 tables** to store all extension data:

1. **user_profiles** - User configuration, company info, target personas, deal metrics
2. **events** - Event metadata (name, dates, location, description, attendee estimates)
3. **people** - All people extracted from events (speakers, attendees, etc.)
4. **sponsors** - Event sponsors and their tiers
5. **expected_personas** - Target personas with conversation starters, pain points, keywords
6. **next_best_actions** - Recommended actions prioritized by importance
7. **related_events** - Similar/related events discovered

### âœ… REST API Endpoints (`event-api.ts`)

**9 endpoints** for complete CRUD operations:

#### Event Management
- `POST /api/events` - Save event analysis
- `GET /api/events` - List all events (with filters)
- `GET /api/events/:url` - Get specific event
- `DELETE /api/events/:url` - Delete event
- `POST /api/events/bulk` - Bulk import events

#### User Profile
- `POST /api/profile` - Save user profile
- `GET /api/profile` - Get user profile

#### Search & Analytics
- `GET /api/people/search?q=...` - Search people across events
- `GET /api/analytics/summary` - Get aggregated analytics

### âœ… Integration (`http-server.ts`)

- Existing MCP server enhanced with Event API
- Database auto-initialization on startup
- Optional bearer token authentication
- CORS enabled for browser extension

### âœ… Documentation

- **EVENT_API.md** - Complete API reference with examples
- **EXTENSION_BACKEND_INTEGRATION.md** - Step-by-step integration guide
- **BACKEND_SETUP_SUMMARY.md** - This file

## Data Flow

```
Browser Extension â†’ Gemini API â†’ Parse Results â†’ Backend API â†’ Turso Database
                                        â†“
                                   Local Storage (cache)
```

**All event analysis data is captured:**
- Event details (name, dates, location, description, attendee count)
- People (name, role, title, company, persona, LinkedIn, messages)
- Sponsors (name, tier)
- Target personas (likelihood, count, conversation starters, keywords, pain points)
- Next best actions (priority, action, reason)
- Related events (name, url, date, relevance)

## Quick Start

### 1. Environment Setup

Create `.env` file in `unified-mcp-server/`:

```bash
TURSO_DATABASE_URL=libsql://your-database.turso.io
TURSO_AUTH_TOKEN=your_auth_token_here
MCP_BEARER_TOKEN=optional_secure_token_for_auth
PORT=3000
```

### 2. Install & Start Backend

```bash
cd unified-mcp-server
npm install
npm run build
npm start
```

Server runs on `http://localhost:3000`

### 3. Verify Backend

```bash
curl http://localhost:3000/health
```

Expected output:
```json
{
  "status": "ok",
  "server": "unified-mcp",
  "version": "1.0.0",
  "tools": 19,
  "eventApi": "enabled"
}
```

### 4. Test Event Storage

```bash
curl -X POST http://localhost:3000/api/events \
  -H "Content-Type: application/json" \
  -H "X-User-Id: test_user" \
  -d '{
    "url": "https://example.com/conference",
    "eventName": "Test Conference 2026",
    "people": [],
    "sponsors": [],
    "expectedPersonas": [],
    "nextBestActions": [],
    "relatedEvents": []
  }'
```

### 5. Integrate Extension

Follow **EXTENSION_BACKEND_INTEGRATION.md** for complete integration steps.

**Quick version:**
1. Add `config.js` with API_BASE_URL
2. Add `backend-api.js` client
3. Update `background.js` to call `backendAPI.saveEvent()` after analysis
4. Update `sidepanel.js` to sync profile and load events

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Browser Extension                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  sidepanel.js                                         â”‚   â”‚
â”‚  â”‚  - User initiates analysis                           â”‚   â”‚
â”‚  â”‚  - Extracts page content                             â”‚   â”‚
â”‚  â”‚  - Sends to background.js                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  background.js                                        â”‚   â”‚
â”‚  â”‚  - Calls Gemini API                                  â”‚   â”‚
â”‚  â”‚  - Parses JSON response                              â”‚   â”‚
â”‚  â”‚  - Extracts all data (people, personas, etc)        â”‚   â”‚
â”‚  â”‚  - Saves to local storage (cache)                   â”‚   â”‚
â”‚  â”‚  - Calls backendAPI.saveEvent()  â—„â”€â”€â”€ NEW           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTP POST /api/events
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Backend Server                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  http-server.ts                                       â”‚   â”‚
â”‚  â”‚  - Express REST API                                  â”‚   â”‚
â”‚  â”‚  - CORS enabled                                      â”‚   â”‚
â”‚  â”‚  - Optional bearer auth                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  event-api.ts                                         â”‚   â”‚
â”‚  â”‚  - Route handlers                                    â”‚   â”‚
â”‚  â”‚  - Request validation                                â”‚   â”‚
â”‚  â”‚  - User ID extraction                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  event-db.ts                                          â”‚   â”‚
â”‚  â”‚  - Database client (libsql)                          â”‚   â”‚
â”‚  â”‚  - CRUD operations                                   â”‚   â”‚
â”‚  â”‚  - Data persistence                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ SQL queries
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Turso Database                           â”‚
â”‚  - user_profiles table                                       â”‚
â”‚  - events table                                              â”‚
â”‚  - people table (linked to events)                          â”‚
â”‚  - sponsors table (linked to events)                        â”‚
â”‚  - expected_personas table (linked to events)               â”‚
â”‚  - next_best_actions table (linked to events)               â”‚
â”‚  - related_events table (linked to events)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## What Data Gets Saved

### From Event Analysis

Every field from the Gemini API response is stored:

```javascript
{
  // Event metadata
  eventName: "AI Summit 2026",
  date: "March 15-17, 2026",
  startDate: "2026-03-15",
  endDate: "2026-03-17",
  location: "San Francisco, CA",
  description: "Annual conference...",
  estimatedAttendees: 5000,
  
  // People (speakers, attendees, organizers)
  people: [
    {
      name: "Jane Smith",
      role: "Speaker",
      title: "VP of Engineering",
      company: "TechCorp",
      persona: "Executive",
      linkedin: "https://linkedin.com/in/janesmith",
      linkedinMessage: "Hi Jane, excited about your talk...",
      iceBreaker: "I loved your recent post on AI ethics..."
    }
  ],
  
  // Sponsors
  sponsors: [
    { name: "CloudCo", tier: "Platinum" }
  ],
  
  // Target personas with full context
  expectedPersonas: [
    {
      persona: "VP of Operations",
      likelihood: "High",
      count: "50+",
      linkedinMessage: "Hi, I see you're attending...",
      iceBreaker: "What brings you to the AI Summit?",
      conversationStarters: [
        "How are you thinking about AI adoption?",
        "What's your biggest operational challenge?"
      ],
      keywords: ["operations", "efficiency", "automation"],
      painPoints: ["Manual processes", "Data silos"]
    }
  ],
  
  // Recommended actions
  nextBestActions: [
    {
      priority: 1,
      action: "Book meeting with Jane Smith",
      reason: "Key decision maker at target account"
    }
  ],
  
  // Related/similar events
  relatedEvents: [
    {
      name: "AI Expo 2026",
      url: "https://aiexpo.com",
      date: "April 2026",
      relevance: "Similar audience, same organizer"
    }
  ]
}
```

### From User Profile

All user configuration is stored for personalized analysis:

```javascript
{
  companyName: "MyCompany",
  yourRole: "Sales Engineer",
  product: "AI Platform",
  valueProp: "10x faster data processing",
  targetPersonas: "CTO, VP Engineering, Data Scientists",
  targetIndustries: "SaaS, FinTech, Healthcare",
  competitors: "CompetitorA, CompetitorB",
  dealSize: "50000",
  conversionRate: "15",
  oppWinRate: "25",
  eventGoal: "Generate 10 qualified leads per event",
  notes: "Focus on Fortune 500"
}
```

## Features Enabled by Backend

### âœ… Cross-Device Sync
- Events saved on one device accessible from any device
- User profile synced across all devices

### âœ… Data Persistence
- No data loss from clearing browser cache
- Permanent storage in Turso cloud database

### âœ… Advanced Search
- Search people across all events
- Find specific personas, companies, or titles

### âœ… Analytics
- Aggregate stats across all events
- Track top personas, upcoming events
- Calculate ROI based on deal metrics

### âœ… Team Collaboration (Future)
- Share events with team members
- Collaborative notes and assignments
- Team-wide analytics

### âœ… API Access
- Programmatic access to all data
- Integration with CRM systems
- Custom reporting and dashboards

## Security

### Authentication (Optional)

Set `MCP_BEARER_TOKEN` environment variable:
```bash
export MCP_BEARER_TOKEN=$(openssl rand -hex 32)
```

Extension must include in all requests:
```javascript
headers: {
  'Authorization': 'Bearer YOUR_TOKEN_HERE'
}
```

### User Isolation

Each user has isolated data via `userId`:
- Set via `X-User-Id` header
- Generated automatically in extension
- All queries filtered by userId

### Data Privacy

- No geminiApiKey exposed in API responses
- User profiles only accessible to owner
- CORS restricts access to authorized origins

## Production Deployment

### Recommended Platforms

**Railway** (Easiest)
```bash
# Push to GitHub, then:
# 1. Connect Railway to repo
# 2. Add environment variables
# 3. Deploy automatically
```

**Fly.io** (Best for edge/global)
```bash
fly launch
fly secrets set TURSO_DATABASE_URL=...
fly secrets set TURSO_AUTH_TOKEN=...
fly secrets set MCP_BEARER_TOKEN=...
fly deploy
```

**Vercel** (For serverless)
- Use Vercel Edge Functions
- Configure Turso connection
- Deploy via GitHub integration

### Production Checklist

- [ ] Set strong MCP_BEARER_TOKEN
- [ ] Enable HTTPS (automatic on Railway/Fly.io)
- [ ] Configure CORS for production domains
- [ ] Set up monitoring (e.g., Better Stack)
- [ ] Configure rate limiting
- [ ] Set up database backups (Turso handles this)
- [ ] Update extension with production API URL
- [ ] Test all endpoints in production

## Monitoring

### Health Check Endpoint

```bash
curl https://your-backend.com/health
```

### Check Event Count

```bash
curl https://your-backend.com/api/analytics/summary \
  -H "Authorization: Bearer $TOKEN" \
  -H "X-User-Id: $USER_ID"
```

### Recent Events

```bash
curl "https://your-backend.com/api/events?limit=10" \
  -H "Authorization: Bearer $TOKEN" \
  -H "X-User-Id: $USER_ID"
```

## Troubleshooting

### Backend won't start

- Check TURSO_DATABASE_URL and TURSO_AUTH_TOKEN are set
- Verify Turso database is accessible
- Check port 3000 is not in use: `lsof -i :3000`

### Extension can't connect

- Verify backend URL in config.js
- Check CORS settings in http-server.ts
- Inspect network tab for failed requests
- Verify bearer token matches (if enabled)

### Events not saving

- Check backend logs for errors
- Verify request body format matches expected schema
- Test with curl to isolate client vs server issues
- Check database write permissions

## Next Steps

1. **Start the backend**: `cd unified-mcp-server && npm start`
2. **Integrate extension**: Follow EXTENSION_BACKEND_INTEGRATION.md
3. **Test end-to-end**: Analyze an event, verify in database
4. **Deploy to production**: Use Railway or Fly.io
5. **Enable authentication**: Set MCP_BEARER_TOKEN

## Files Created

```
unified-mcp-server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ event-db.ts           â† Database schema & operations (NEW)
â”‚   â”œâ”€â”€ event-api.ts          â† REST API routes (NEW)
â”‚   â””â”€â”€ http-server.ts        â† Updated with event API integration
â”œâ”€â”€ EVENT_API.md              â† API reference documentation (NEW)
â””â”€â”€ package.json              â† Dependencies already included

EXTENSION_BACKEND_INTEGRATION.md  â† Integration guide (NEW)
BACKEND_SETUP_SUMMARY.md          â† This file (NEW)
```

## Support

Questions or issues:
1. Check server logs: `npm start` in unified-mcp-server/
2. Review API docs: EVENT_API.md
3. Test endpoints with curl
4. Check TypeScript types in event-db.ts for data structure

---

**Backend is ready to receive all browser extension data! ğŸš€**
